// Open Pixel v1.3.0 | Published By Dockwa | Created By Stuart Yamartino | MIT License
!function(A,h,i){"use strict";function a(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u={id:"",params:{},version:1,datahost:"https://us-central1-trakmarket-prod.cloudfunctions.net",host:"https://trakmkt.com",iphost:"https://api.ipify.org?format=json",ipinfo:"https://ipinfo.io/json"},y=function(){function U(){r(this,U)}return t(U,null,[{key:"isPresent",value:function(e){return null!=e&&""!==e}},{key:"now",value:function(){return+new Date}},{key:"guid",value:function(){return u.version+"-xxxxxxxx-".replace(/[x]/g,function(e){var t=36*Math.random()|0;return("x"==e?t:3&t|8).toString(36)})+(+new Date).toString(36)}},{key:"optionalData",value:function(e){if(!1!==U.isPresent(e))return"object"===H(e)?U.optionalData(JSON.stringify(e)):"function"==typeof e?U.optionalData(e()):String(e);if(M.exists("b")&&M.exists("a")&&M.exists("e")){var t,n,i,a,r,s=M.exists("ak")?M.get("ak"):"",o=M.exists("au")?M.get("au"):"",u="";if(""!==s){var c=JSON.parse(U.recoveryString(s));if("number"==typeof c.length&&0<c.length)for(var l=A.location.href,g=0;g<c.length;g++){var f=c[g],p=f.keyword;l.includes(p)&&(D=f.id?f.id:"",I=f.class?f.class:"",u=U.getSale(D,I))}}return""===o||""!==u||"string"==typeof(t=JSON.parse(U.recoveryString(o))).url&&(i=(n=t).secure+"://"+("/"===n.url[n.url.length-1]?n.url.substring(0,n.url.length-2):n.url),A.location.href.includes(i)&&(a=n.id?n.id:"",r=n.class?n.class:"",u=U.getSale(a,r))),U.optionalData({a:M.get("a"),b:M.get("b"),c:M.get("c"),e:M.get("e"),cu:M.exists("cu")?M.get("cu"):"",au:o,ak:s,lu:M.exists("lu")?M.get("lu"):"",lk:M.exists("lk")?M.get("lk"):"",banner:M.exists("banner")?M.get("banner"):"",session:M.existsS("session")?M.getS("session"):"",sale:u,multisite:!1})}if(M.exists("campaigns")){var m=JSON.parse(M.get("campaigns")),d=A.location.href,h="",y=null,v="",x=1;if("number"==typeof m.length&&0<m.length){var b=m;if(!M.exists("checkO")&&M.exists("checkM")){for(var S=0;S<b.length;S++){var P=b[S];if(void 0!==P.multiSiteCpa&&null===y){var w,O=P.cpa,N=O.keywords;if(void 0!==N&&"number"==typeof N.length&&0<N.length)for(var B=0;B<N.length;B++){var D,I,_=N[B];d.includes(_.keyword)&&""===h&&(D=_.id?_.id:"",I=_.class?_.class:"",h=U.getSale(D,I),y=P,v="cpa",x=_.salePosition?+_.salePosition:1)}void 0!==O.url.url&&O.url.url.includes("/")&&null===y&&(w=O.url.url,d.includes(w)&&""===h&&(D=O.url.id?k.id:"",I=O.url.class?O.url.class:"",h=U.getSale(D,I),y=P,v="cpa",x=O.url.salePosition?+O.url.salePosition:1))}if(P.multiSiteCpl&&null===y){var j,C=P.cpl,T=C.keywords;if(void 0!==T&&"number"==typeof T.length&&0<T.length)for(var E=0;E<T.length;E++){var J=T[E];d.includes(J.keyword)&&(y=P,v="cpl")}void 0!==C.url.url&&C.url.url.includes("/")&&null===y&&(j=C.url.url,d.includes(j)&&(y=P,v="cpl"))}}return U.optionalData({campaign:y,campaigns:b,type:v,session:M.existsS("session")?M.getS("session"):"",sale:h,multisite:!0,salePosition:x})}}}return""}},{key:"createTime",value:function(){var e=M.exists("pers")?+M.get("pers"):8,t=new Date;return t.setDate(t.getDate()+e),t.toISOString()}},{key:"timeDelete",value:function(e){return+e<(new Date).getTime()}},{key:"gsuid",value:function(){return(+new Date).toString(36)}},{key:"getSale",value:function(e,t){var n,i,a=[];if(""!==e&&((n=h.getElementById(e))?(i=n.innerHTML.replace(/<[^<>]*>/g,""),a.push(i)):console.log("soy nulo")),0===a.length&&""!==t){var r=t.split("/");if(1===r.length){var s=h.getElementsByClassName(t);if(0<s.length)for(var o=0;o<s.length;o++){var u=s[o].innerHTML.replace(/<[^<>]*>/g,"").replace(/,/g,".");a.push(u)}}else if(1<r.length){var c=h.getElementsByClassName(r[0]);if(0<c.length&&0<c[0].children.length)for(var l=0;l<c[0].children.length;l++){var g=c[0].children[l];g.localName===r[1]&&a.push(g.textContent.replace(/\$/g,"").replace(/,/g,"."))}}}return 0<a.length?a.toString().replace(/\\n/g,""):""}}]),U}();o(y,"recoveryString",function(e){return e.replace(/_comma_/g,",").replace(/_dash_/g,"/").replace(/_point_/g,".").replace(/_colon_/g,":").replace(/_bracketo_/g,"[").replace(/_bracketc_/g,"]").replace(/_braceo_/g,"{").replace(/_bracec_/g,"}").replace(/_quote_/g,'"').replace(/_bslash_/g,"\\")});var c=function(){function e(){r(this,e)}return t(e,null,[{key:"nameAndVersion",value:function(){var e,t=navigator.userAgent.replace(/CriOS/g,"Chrome"),n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}},{key:"isMobile",value:function(){return"ontouchstart"in A||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints}},{key:"userAgent",value:function(){return A.navigator.userAgent}}]),e}(),M=function(){function e(){r(this,e)}return t(e,null,[{key:"prefix",value:function(){return"__".concat("opix","_")}},{key:"loc",value:function(){return A.localStorage}},{key:"sess",value:function(){return A.sessionStorage}},{key:"set",value:function(e,t){this.loc().setItem("".concat(this.prefix()).concat(e),t)}},{key:"get",value:function(e){return this.loc().getItem("".concat(this.prefix()).concat(e))}},{key:"delete",value:function(e){this.loc().removeItem("".concat(this.prefix()).concat(e))}},{key:"exists",value:function(e){return null!=this.get(e)}},{key:"setS",value:function(e,t){this.sess().setItem("".concat(this.prefix()).concat(e),t)}},{key:"getS",value:function(e){return this.sess().getItem("".concat(this.prefix()).concat(e))}},{key:"deleteS",value:function(e){this.sess().removeItem("".concat(this.prefix()).concat(e))}},{key:"existsS",value:function(e){return null!=this.getS(e)}},{key:"setUtms",value:function(){for(var e=["utm_source","utm_medium","utm_term","utm_content","utm_campaign"],t=!1,n=0,i=e.length;n<i;n++)if(y.isPresent(l.getParameterByName(e[n]))){t=!0;break}if(t){for(var a,r={},n=0,i=e.length;n<i;n++)a=l.getParameterByName(e[n]),y.isPresent(a)&&(r[e[n]]=a);this.set("utm",JSON.stringify(r))}}},{key:"getUtm",value:function(e){if(this.exists("utm")){var t=JSON.parse(this.get("utm"));return e in t?t[e]:""}}},{key:"clear",value:function(){for(var e,t=["utm","a","b","c","e","pers","time","checkC","uid","lu","lk","au","ak","cu"],n=0,i=t.length;n<i;n++)e=t[n],this.exists(e)&&this.delete(e),this.existsS(e)&&this.deleteS(e)}}]),e}(),e=function(){function g(){r(this,g)}return t(g,null,[{key:"getIp",value:function(){axios.get(u.iphost).then(function(e){var t,n=e.data.ip;M.exists("ip")&&M.get("ip")==n?(t=(new Date).getDate(),M.set("check",t)):g.existsIp(n),M.set("ip",e.data.ip)})}},{key:"existsIp",value:function(e){axios.get(u.datahost+"/ip/"+e).then(function(e){var t,n,i,a,r,s,o,u,c,l=e.data;""!=l?(t=l.city,n=l.region,i=l.country,a=l.postal,r=l.timezone,o=(s=l.loc.split(","))[0],u=s[1],M.set("location",JSON.stringify({city:t,region:n,country:i,latitude:o,longitude:u,postal:a,timezone:r})),M.set("ipinfo","ok"),c=(new Date).getDate(),M.set("check",c)):g.getIpInfo()})}},{key:"getIpInfo",value:function(){axios.get(u.ipinfo).then(function(e){var t=e.data,n=t.city,i=t.region,a=t.country,r=t.postal,s=t.timezone,o=t.loc.split(","),u=o[0],c=o[1];M.set("ipinfo",JSON.stringify(t)),M.set("location",JSON.stringify({city:n,region:i,country:a,latitude:u,longitude:c,postal:r,timezone:s})),g.saveIpInfo(t)})}},{key:"saveIpInfo",value:function(l){axios.post(u.datahost+"/ip",l).then(function(e){var t=l.city,n=l.region,i=l.country,a=l.postal,r=l.timezone,s=l.loc.split(","),o=s[0],u=s[1];M.set("location",JSON.stringify({city:t,region:n,country:i,latitude:o,longitude:u,postal:a,timezone:r})),M.set("ipinfo","ok");var c=(new Date).getDate();M.set("check",c)})}}]),g}(),l=function(){function e(){r(this,e)}return t(e,null,[{key:"getParameterByName",value:function(e,t){t=t||A.location.href,e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}},{key:"externalHost",value:function(e){return e.hostname!=location.hostname&&0===e.protocol.indexOf("http")}}]),e}(),v=function(){function i(e,t,n){r(this,i),this.params=[],this.event=e,this.timestamp=t,this.optional=y.optionalData(n),this.buildParams(),this.send()}return t(i,[{key:"buildParams",value:function(){var e=this.getAttribute();for(var t in e)e.hasOwnProperty(t)&&this.setParam(t,e[t](t))}},{key:"getAttribute",value:function(){var e=this;return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({id:function(){return u.id},uid:function(){return M.exists("uid")?M.get("uid"):M.getS("uid")},ev:function(){return e.event},ip:function(){return M.exists("ip")?M.get("ip"):""},location:function(){return M.exists("location")?M.get("location"):""},ed:function(){return e.optional},v:function(){return u.version},dl:function(){return A.location.href},rl:function(){return h.referrer},ts:function(){return e.timestamp},de:function(){return h.characterSet},sr:function(){return A.screen.width+"x"+A.screen.height},vp:function(){return A.innerWidth+"x"+A.innerHeight},cd:function(){return A.screen.colorDepth},dt:function(){return h.title},bn:function(){return c.nameAndVersion()},md:function(){return c.isMobile()},ua:function(){return c.userAgent()},tz:function(){return(new Date).getTimezoneOffset()},utm_source:function(e){return M.getUtm(e)},utm_medium:function(e){return M.getUtm(e)},utm_term:function(e){return M.getUtm(e)},utm_content:function(e){return M.getUtm(e)},utm_campaign:function(e){return M.getUtm(e)}},u.params)}},{key:"setParam",value:function(e,t){y.isPresent(t)?this.params.push("".concat(e,"=").concat(encodeURIComponent(t))):this.params.push("".concat(e,"="))}},{key:"send",value:function(){A.navigator.sendBeacon?this.sendBeacon():this.sendImage()}},{key:"sendBeacon",value:function(){A.navigator.sendBeacon(this.getSourceUrl())}},{key:"sendImage",value:function(){this.img=h.createElement("img"),this.img.src=this.getSourceUrl(),this.img.style.display="none",this.img.width="1",this.img.height="1",h.getElementsByTagName("body")[0].appendChild(this.img)}},{key:"getSourceUrl",value:function(){return"".concat("https://trakmkt.com/pixel","?").concat(this.params.join("&"))}}]),i}();y.isPresent(l.getParameterByName("uid"))?M.set("uid",l.getParameterByName("uid")):M.exists("uid")||M.existsS("uid")||M.setS("uid",y.guid()),y.isPresent(l.getParameterByName("pers"))?M.set("pers",l.getParameterByName("pers")):M.exists("pers")||M.set("pers","1"),y.isPresent(l.getParameterByName("a"))&&M.set("a",l.getParameterByName("a")),y.isPresent(l.getParameterByName("b"))&&M.set("b",l.getParameterByName("b")),y.isPresent(l.getParameterByName("c"))&&M.set("c",l.getParameterByName("c")),y.isPresent(l.getParameterByName("e"))&&M.set("e",l.getParameterByName("e"));var n,g,f=(new Date).getDate().toString();y.isPresent(l.getParameterByName("cu"))&&M.set("cu",l.getParameterByName("cu")),y.isPresent(l.getParameterByName("lu"))&&M.set("lu",l.getParameterByName("lu")),y.isPresent(l.getParameterByName("lk"))&&M.set("lk",l.getParameterByName("lk")),y.isPresent(l.getParameterByName("au"))&&M.set("au",l.getParameterByName("au")),y.isPresent(l.getParameterByName("ak"))&&M.set("ak",l.getParameterByName("ak")),y.isPresent(l.getParameterByName("banner"))&&M.set("banner",l.getParameterByName("banner")),y.isPresent(l.getParameterByName("c"))&&M.set("checkC",f),M.exists("time")?y.timeDelete(M.get("time"))&&M.clear():M.set("time",y.createTime()),M.existsS("session")||M.setS("session",y.gsuid()),M.setUtms(),"undefined"!=typeof axios&&(M.exists("c")&&M.get("checkC")!=f&&(n=M.get("c"),axios.get(u.datahost+"/campaign/"+n).then(function(e){var t,n,i,a;"active"===e.data.status?((t=e.data.persistence)!=(n=+M.get("pers"))&&(i=new Date,(a=new Date(M.get("time"))).setDate(a.getDate()-n+t),i.getTime()<a.getTime()?(M.delete("pers"),M.delete("time"),M.set("pers",t),M.set("time",a.toISOString())):M.clear()),M.set("cu",e.data.cu),M.set("au",e.data.au),M.set("lu",e.data.lu),M.set("ak",e.data.ak),M.set("lk",e.data.lk),M.set("checkC",f)):M.clear()})),!M.exists("c")&&M.get("checkO")&&(g=A.location.href.split("/")[2],axios.get(u.datahost+"/site/only/"+g).then(function(e){var t=e.data;M.set("campaigns",JSON.stringify(t)),M.set("checkO",f)})),M.exists("check")&&M.get("check")==f||e.getIp(),M.exists("ip")&&(M.exists("ipinfo")&&"ok"!=M.get("ipinfo")?e.saveIpInfo(JSON.parse(M.get("ipinfo"))):M.exists("ipinfo")||e.existsIp(M.get("ip")))),i.process=function(e,t,n){"init"===e?u.id=t:"param"===e?u.params[t]=function(){return n}:"event"===e&&(t.includes("pageload")&&!u.pageLoadOnce?new v(t,i.t,n):t.includes("pageload")||"pageclose"===t||new v(t,y.now(),n))};for(var p=0,m=i.queue.length;p<m;p++)i.process.apply(i,i.queue[p]);var d="object"===("undefined"==typeof safari?"undefined":H(safari))&&safari.pushNotification,x="onpageshow"in self&&!d?"pagehide":"unload";A.addEventListener(x,function(){u.pageCloseOnce||u.id.includes("-")||(u.pageCloseOnce=!0,new v("pageclose",y.now(),function(){if(y.isPresent(u.externalHost)&&y.now()-u.externalHost.time<5e3)return u.externalHost.link}))}),A.onload=function(){var a,e,t,f,p,m,d;u.id.includes("-")?u.id.includes("-")&&(a=(new Date).getDate().toString(),u.pageCloseOnce=!0,M.get("checkM")!=a&&(e=A.location.href.split("/")[2],axios.get(u.datahost+"/site/multi/"+e+"?ua="+c.userAgent()).then(function(e){var t,n=e.data.campaigns,i=e.data.uid;M.set("campaigns",JSON.stringify(n)),M.set("checkM",a),console.log("obtuve campañas"),""!==i&&(M.exists("uid")||M.set("uid",i),console.log("uid changed"),t=A.location.href,new v("pageload",y.now()),setTimeout(function(){new v("pageload-5s",y.now())},5e3),t=A.location.href,setInterval(function(){var e=A.location.href;t!=e&&(new v("pageload-sp",y.now()),t=e)},1823))})),M.exists("campaigns")&&M.exists("uid")&&(new v("pageload",y.now()),t=A.location.href,"undefined"==typeof dl&&setTimeout(function(){new v("pageload-5s",y.now())},5e3),setInterval(function(){var e=A.location.href;t!=e&&(new v("pageload-sp",y.now()),t=e)},1823))):(new v("pageloaded",y.now()),t=location.href,"undefined"==typeof dl&&setTimeout(function(){new v("pageload-5s",y.now())},5e3),setInterval(function(){var e=location.href;t!==e&&(new v("pageload-sp",y.now()),t=e)},1823),M.exists("uid")&&"S"===M.get("uid")[0]&&M.exists("b")&&M.exists("a")&&M.exists("e")&&(f=M.exists("ak")?M.get("ak"):"",p=M.exists("au")?M.get("au"):"",d=0,(m="")===f&&""===p||setInterval(function(){if(""===m&&""!==f){var e=JSON.parse(y.recoveryString(f));if("number"==typeof e.length&&0<e.length)for(var t=A.location.href,n=0;n<e.length;n++){var i,a,r=e[n],s=r.keyword;t.includes(s)&&(i=r.id?r.id:"",a=r.class?r.class:"",m=y.getSale(i,a))}}var o,u,c,l,g;""!==m||""===p||"string"==typeof(o=JSON.parse(y.recoveryString(p))).url&&(c=(u=o).secure+"://"+("/"===u.url[u.url.length-1]?u.url.substring(0,u.url.length-2):u.url),A.location.href.includes(c)&&(l=u.id?u.id:"",g=u.class?u.class:"",m=y.getSale(l,g))),""!==m&&d<18&&(d++,new v("pageloaded",y.now(),{a:M.get("a"),b:M.get("b"),c:M.get("c"),e:M.get("e"),cu:M.exists("cu")?M.get("cu"):"",au:p,ak:f,lu:M.exists("lu")?M.get("lu"):"",lk:M.exists("lk")?M.get("lk"):"",banner:M.exists("banner")?M.get("banner"):"",session:M.existsS("session")?M.getS("session"):"",sale:m,multisite:!1}))},800)));for(var n=h.getElementsByTagName("a"),i=0,r=n.length;i<r;i++)n[i].addEventListener("click",function(e){l.externalHost(this)&&(u.externalHost={link:this.href,time:y.now()})}.bind(n[i]));for(var s=h.querySelectorAll("[data-opix-event]"),i=0,r=s.length;i<r;i++)s[i].addEventListener("click",function(e){var t=this.getAttribute("data-opix-event");t&&new v(t,y.now(),this.getAttribute("data-opix-data"))}.bind(s[i]))}}(window,document,window.opix);